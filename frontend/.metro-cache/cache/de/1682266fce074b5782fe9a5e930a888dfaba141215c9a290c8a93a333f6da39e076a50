{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/asyncIterator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"iAa+RToycgxigMSWyQzterF69/I=","exportNames":["*"],"imports":1}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":24},"end":{"line":2,"column":38,"index":62}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"streamedQuery\", {\n    enumerable: true,\n    get: function () {\n      return streamedQuery;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _babelRuntimeHelpersAsyncIterator = require(_dependencyMap[1], \"@babel/runtime/helpers/asyncIterator\");\n  var _asyncIterator = _interopDefault(_babelRuntimeHelpersAsyncIterator);\n  var _utilsJs = require(_dependencyMap[2], \"./utils.js\");\n  // src/streamedQuery.ts\n\n  function streamedQuery(_ref) {\n    var streamFn = _ref.streamFn,\n      _ref$refetchMode = _ref.refetchMode,\n      refetchMode = _ref$refetchMode === void 0 ? \"reset\" : _ref$refetchMode,\n      _ref$reducer = _ref.reducer,\n      reducer = _ref$reducer === void 0 ? function (items, chunk) {\n        return (0, _utilsJs.addToEnd)(items, chunk);\n      } : _ref$reducer,\n      _ref$initialValue = _ref.initialValue,\n      initialValue = _ref$initialValue === void 0 ? [] : _ref$initialValue;\n    return /*#__PURE__*/function () {\n      var _ref2 = (0, _asyncToGenerator.default)(function* (context) {\n        var _context$client$getQu;\n        var query = context.client.getQueryCache().find({\n          queryKey: context.queryKey,\n          exact: true\n        });\n        var isRefetch = !!query && query.state.data !== void 0;\n        if (isRefetch && refetchMode === \"reset\") {\n          query.setState({\n            status: \"pending\",\n            data: void 0,\n            error: null,\n            fetchStatus: \"fetching\"\n          });\n        }\n        var result = initialValue;\n        var stream = yield streamFn(context);\n        var _iteratorAbruptCompletion = false;\n        var _didIteratorError = false;\n        var _iteratorError;\n        try {\n          var _loop = function* _loop() {\n            var chunk = _step.value;\n            {\n              if (context.signal.aborted) {\n                return 1; // break\n              }\n              if (!isRefetch || refetchMode !== \"replace\") {\n                context.client.setQueryData(context.queryKey, function (prev) {\n                  return reducer(prev === void 0 ? initialValue : prev, chunk);\n                });\n              }\n              result = reducer(result, chunk);\n            }\n          };\n          for (var _iterator = (0, _asyncIterator.default)(stream), _step; _iteratorAbruptCompletion = !(_step = yield _iterator.next()).done; _iteratorAbruptCompletion = false) {\n            if (yield* _loop()) break;\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (_iteratorAbruptCompletion && _iterator.return != null) {\n              yield _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n        if (isRefetch && refetchMode === \"replace\" && !context.signal.aborted) {\n          context.client.setQueryData(context.queryKey, result);\n        }\n        return (_context$client$getQu = context.client.getQueryData(context.queryKey)) != null ? _context$client$getQu : initialValue;\n      });\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n  }\n});","lineCount":98,"map":[[12,2,40,0,"Object"],[12,8,40,0],[12,9,40,0,"defineProperty"],[12,23,40,0],[12,24,40,0,"exports"],[12,31,40,0],[13,4,40,0,"enumerable"],[13,14,40,0],[14,4,40,0,"get"],[14,7,40,0],[14,18,40,0,"get"],[14,19,40,0],[15,6,40,0],[15,13,41,2,"streamedQuery"],[15,26,41,15],[16,4,41,15],[17,2,41,15],[18,2,42,2],[18,6,42,2,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,42,2],[18,45,42,2,"require"],[18,52,42,2],[18,53,42,2,"_dependencyMap"],[18,67,42,2],[19,2,42,2],[19,6,42,2,"_asyncToGenerator"],[19,23,42,2],[19,26,42,2,"_interopDefault"],[19,41,42,2],[19,42,42,2,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,42,2],[20,2,42,2],[20,6,42,2,"_babelRuntimeHelpersAsyncIterator"],[20,39,42,2],[20,42,42,2,"require"],[20,49,42,2],[20,50,42,2,"_dependencyMap"],[20,64,42,2],[21,2,42,2],[21,6,42,2,"_asyncIterator"],[21,20,42,2],[21,23,42,2,"_interopDefault"],[21,38,42,2],[21,39,42,2,"_babelRuntimeHelpersAsyncIterator"],[21,72,42,2],[22,2,2,0],[22,6,2,0,"_utilsJs"],[22,14,2,0],[22,17,2,0,"require"],[22,24,2,0],[22,25,2,0,"_dependencyMap"],[22,39,2,0],[23,2,1,0],[25,2,3,0],[25,11,3,9,"streamedQuery"],[25,24,3,22,"streamedQuery"],[25,25,3,22,"_ref"],[25,29,3,22],[25,31,8,3],[26,4,8,3],[26,8,4,2,"streamFn"],[26,16,4,10],[26,19,4,10,"_ref"],[26,23,4,10],[26,24,4,2,"streamFn"],[26,32,4,10],[27,6,4,10,"_ref$refetchMode"],[27,22,4,10],[27,25,4,10,"_ref"],[27,29,4,10],[27,30,5,2,"refetchMode"],[27,41,5,13],[28,6,5,2,"refetchMode"],[28,17,5,13],[28,20,5,13,"_ref$refetchMode"],[28,36,5,13],[28,50,5,16],[28,57,5,23],[28,60,5,23,"_ref$refetchMode"],[28,76,5,23],[29,6,5,23,"_ref$reducer"],[29,18,5,23],[29,21,5,23,"_ref"],[29,25,5,23],[29,26,6,2,"reducer"],[29,33,6,9],[30,6,6,2,"reducer"],[30,13,6,9],[30,16,6,9,"_ref$reducer"],[30,28,6,9],[30,42,6,12],[30,52,6,13,"items"],[30,57,6,18],[30,59,6,20,"chunk"],[30,64,6,25],[31,8,6,25],[31,15,6,30],[31,19,6,30,"addToEnd"],[31,27,6,38],[31,28,6,38,"addToEnd"],[31,36,6,38],[31,38,6,39,"items"],[31,43,6,44],[31,45,6,46,"chunk"],[31,50,6,51],[31,51,6,52],[32,6,6,52],[32,10,6,52,"_ref$reducer"],[32,22,6,52],[33,6,6,52,"_ref$initialValue"],[33,23,6,52],[33,26,6,52,"_ref"],[33,30,6,52],[33,31,7,2,"initialValue"],[33,43,7,14],[34,6,7,2,"initialValue"],[34,18,7,14],[34,21,7,14,"_ref$initialValue"],[34,38,7,14],[34,52,7,17],[34,54,7,19],[34,57,7,19,"_ref$initialValue"],[34,74,7,19],[35,4,9,2],[36,6,9,2],[36,10,9,2,"_ref2"],[36,15,9,2],[36,22,9,2,"_asyncToGenerator"],[36,39,9,2],[36,40,9,2,"default"],[36,47,9,2],[36,49,9,9],[36,60,9,16,"context"],[36,67,9,23],[36,69,9,28],[37,8,9,28],[37,12,9,28,"_context$client$getQu"],[37,33,9,28],[38,8,10,4],[38,12,10,10,"query"],[38,17,10,15],[38,20,10,18,"context"],[38,27,10,25],[38,28,10,26,"client"],[38,34,10,32],[38,35,10,33,"getQueryCache"],[38,48,10,46],[38,49,10,47],[38,50,10,48],[38,51,10,49,"find"],[38,55,10,53],[38,56,10,54],[39,10,10,56,"queryKey"],[39,18,10,64],[39,20,10,66,"context"],[39,27,10,73],[39,28,10,74,"queryKey"],[39,36,10,82],[40,10,10,84,"exact"],[40,15,10,89],[40,17,10,91],[41,8,10,96],[41,9,10,97],[41,10,10,98],[42,8,11,4],[42,12,11,10,"isRefetch"],[42,21,11,19],[42,24,11,22],[42,25,11,23],[42,26,11,24,"query"],[42,31,11,29],[42,35,11,33,"query"],[42,40,11,38],[42,41,11,39,"state"],[42,46,11,44],[42,47,11,45,"data"],[42,51,11,49],[42,56,11,54],[42,61,11,59],[42,62,11,60],[43,8,12,4],[43,12,12,8,"isRefetch"],[43,21,12,17],[43,25,12,21,"refetchMode"],[43,36,12,32],[43,41,12,37],[43,48,12,44],[43,50,12,46],[44,10,13,6,"query"],[44,15,13,11],[44,16,13,12,"setState"],[44,24,13,20],[44,25,13,21],[45,12,14,8,"status"],[45,18,14,14],[45,20,14,16],[45,29,14,25],[46,12,15,8,"data"],[46,16,15,12],[46,18,15,14],[46,23,15,19],[46,24,15,20],[47,12,16,8,"error"],[47,17,16,13],[47,19,16,15],[47,23,16,19],[48,12,17,8,"fetchStatus"],[48,23,17,19],[48,25,17,21],[49,10,18,6],[49,11,18,7],[49,12,18,8],[50,8,19,4],[51,8,20,4],[51,12,20,8,"result"],[51,18,20,14],[51,21,20,17,"initialValue"],[51,33,20,29],[52,8,21,4],[52,12,21,10,"stream"],[52,18,21,16],[52,27,21,25,"streamFn"],[52,35,21,33],[52,36,21,34,"context"],[52,43,21,41],[52,44,21,42],[53,8,21,43],[53,12,21,43,"_iteratorAbruptCompletion"],[53,37,21,43],[54,8,21,43],[54,12,21,43,"_didIteratorError"],[54,29,21,43],[55,8,21,43],[55,12,21,43,"_iteratorError"],[55,26,21,43],[56,8,21,43],[57,10,21,43],[57,14,21,43,"_loop"],[57,19,21,43],[57,32,21,43,"_loop"],[57,38,21,43],[57,40,22,38],[58,12,22,38],[58,16,22,21,"chunk"],[58,21,22,26],[58,24,22,26,"_step"],[58,29,22,26],[58,30,22,26,"value"],[58,35,22,26],[59,12,22,26],[60,14,23,6],[60,18,23,10,"context"],[60,25,23,17],[60,26,23,18,"signal"],[60,32,23,24],[60,33,23,25,"aborted"],[60,40,23,32],[60,42,23,34],[61,16,23,34],[62,14,25,6],[63,14,26,6],[63,18,26,10],[63,19,26,11,"isRefetch"],[63,28,26,20],[63,32,26,24,"refetchMode"],[63,43,26,35],[63,48,26,40],[63,57,26,49],[63,59,26,51],[64,16,27,8,"context"],[64,23,27,15],[64,24,27,16,"client"],[64,30,27,22],[64,31,27,23,"setQueryData"],[64,43,27,35],[64,44,28,10,"context"],[64,51,28,17],[64,52,28,18,"queryKey"],[64,60,28,26],[64,62,29,10],[64,72,29,11,"prev"],[64,76,29,15],[65,18,29,15],[65,25,29,20,"reducer"],[65,32,29,27],[65,33,29,28,"prev"],[65,37,29,32],[65,42,29,37],[65,47,29,42],[65,48,29,43],[65,51,29,46,"initialValue"],[65,63,29,58],[65,66,29,61,"prev"],[65,70,29,65],[65,72,29,67,"chunk"],[65,77,29,72],[65,78,29,73],[66,16,29,73],[66,17,30,8],[66,18,30,9],[67,14,31,6],[68,14,32,6,"result"],[68,20,32,12],[68,23,32,15,"reducer"],[68,30,32,22],[68,31,32,23,"result"],[68,37,32,29],[68,39,32,31,"chunk"],[68,44,32,36],[68,45,32,37],[69,12,32,38],[70,10,33,4],[70,11,33,5],[71,10,22,4],[71,19,22,4,"_iterator"],[71,28,22,4],[71,35,22,4,"_asyncIterator"],[71,49,22,4],[71,50,22,4,"default"],[71,57,22,4],[71,59,22,30,"stream"],[71,65,22,36],[71,68,22,36,"_step"],[71,73,22,36],[71,75,22,36,"_iteratorAbruptCompletion"],[71,100,22,36],[71,105,22,36,"_step"],[71,110,22,36],[71,119,22,36,"_iterator"],[71,128,22,36],[71,129,22,36,"next"],[71,133,22,36],[71,137,22,36,"done"],[71,141,22,36],[71,143,22,36,"_iteratorAbruptCompletion"],[71,168,22,36],[72,12,22,36],[72,23,22,36,"_loop"],[72,28,22,36],[72,32,24,8],[73,10,24,14],[74,8,33,5],[74,17,33,5,"err"],[74,20,33,5],[75,10,33,5,"_didIteratorError"],[75,27,33,5],[76,10,33,5,"_iteratorError"],[76,24,33,5],[76,27,33,5,"err"],[76,30,33,5],[77,8,33,5],[78,10,33,5],[79,12,33,5],[79,16,33,5,"_iteratorAbruptCompletion"],[79,41,33,5],[79,45,33,5,"_iterator"],[79,54,33,5],[79,55,33,5,"return"],[79,61,33,5],[80,14,33,5],[80,20,33,5,"_iterator"],[80,29,33,5],[80,30,33,5,"return"],[80,36,33,5],[81,12,33,5],[82,10,33,5],[83,12,33,5],[83,16,33,5,"_didIteratorError"],[83,33,33,5],[84,14,33,5],[84,20,33,5,"_iteratorError"],[84,34,33,5],[85,12,33,5],[86,10,33,5],[87,8,33,5],[88,8,34,4],[88,12,34,8,"isRefetch"],[88,21,34,17],[88,25,34,21,"refetchMode"],[88,36,34,32],[88,41,34,37],[88,50,34,46],[88,54,34,50],[88,55,34,51,"context"],[88,62,34,58],[88,63,34,59,"signal"],[88,69,34,65],[88,70,34,66,"aborted"],[88,77,34,73],[88,79,34,75],[89,10,35,6,"context"],[89,17,35,13],[89,18,35,14,"client"],[89,24,35,20],[89,25,35,21,"setQueryData"],[89,37,35,33],[89,38,35,34,"context"],[89,45,35,41],[89,46,35,42,"queryKey"],[89,54,35,50],[89,56,35,52,"result"],[89,62,35,58],[89,63,35,59],[90,8,36,4],[91,8,37,4],[91,16,37,4,"_context$client$getQu"],[91,37,37,4],[91,40,37,11,"context"],[91,47,37,18],[91,48,37,19,"client"],[91,54,37,25],[91,55,37,26,"getQueryData"],[91,67,37,38],[91,68,37,39,"context"],[91,75,37,46],[91,76,37,47,"queryKey"],[91,84,37,55],[91,85,37,56],[91,97,37,56,"_context$client$getQu"],[91,118,37,56],[91,121,37,60,"initialValue"],[91,133,37,72],[92,6,38,2],[92,7,38,3],[93,6,38,3],[93,23,38,3,"_x"],[93,25,38,3],[94,8,38,3],[94,15,38,3,"_ref2"],[94,20,38,3],[94,21,38,3,"apply"],[94,26,38,3],[94,33,38,3,"arguments"],[94,42,38,3],[95,6,38,3],[96,4,38,3],[97,2,39,0],[98,0,39,1],[98,3]],"functionMap":{"names":["<global>","streamedQuery","<anonymous>","context.client.setQueryData$argument_1"],"mappings":"AAA;ACE;YCG,wCD;SCG;UCoB,+DD;GDS;CDC"},"hasCjsExports":false},"type":"js/module"}]}